pub mod linear_recurrence;
pub use linear_recurrence::linear_nth;
pub mod multiply;
pub mod nttcore;
pub use multiply::multiply_u64;
pub mod polyeval;
pub use polyeval::polyeval_u64;
pub mod polymul;
pub use polymul::{polymul_ex_u64, polymul_u64};
mod polyops;
pub use polyops::{polydiv_u64, polyinv_u64, polymod_u64};

#[cfg(test)]
mod test {
    use super::*;

    #[test]
    fn check_multiply_u64() {
        assert_eq!(vec![6, 0], multiply_u64(&[2], &[3]));
        assert_eq!(vec![0, 1, 1], multiply_u64(&[1 << 32, 1 << 32], &[1 << 32]));
        assert_eq!(
            vec![
                338457285041528512,
                873741774122123434,
                1614279433659886989,
                2232618956921417485
            ],
            multiply_u64(
                &[2745895686766400144, 7520886206723962441],
                &[9006621652498007052, 5476023620144815056]
            )
        );
    }
    #[test]
    fn check_polymul_u64() {
        assert_eq!(vec![6], polymul_u64(&[2], &[3], 0));
        assert_eq!(vec![0, 0], polymul_u64(&[1 << 32, 1 << 32], &[1 << 32], 0));
        assert_eq!(
            vec![388856412, 499682766, 44258992],
            polymul_u64(
                &[2745895686766400144, 7520886206723962441],
                &[9006621652498007052, 5476023620144815056],
                1000000007
            )
        );
        assert_eq!(
            vec![
                16889012037339467114,
                15272081445206089825,
                5723988045866129237
            ],
            polymul_u64(
                &[2745895686766400144, 7520886206723962441],
                &[9006621652498007052, 5476023620144815056],
                18446744073606613507
            )
        );
        assert_eq!(
            vec![
                16803317, 24661492, 53722019, 121854443, 132232730, 161886248, 156089903,
                181590667, 243299694, 225422178, 223644833, 263121318, 302992449, 410263000,
                344651664, 352101535, 406075519, 434073510, 470574727, 424838498, 456995544,
                467924728, 427541212, 452831334, 423515813, 301825333, 314335826, 333008923,
                278360148, 287755801, 205365793, 247892282, 191150533, 155900852, 133450890,
                136250719, 74513858, 63236069, 49693509, 27702184, 48570963
            ],
            polymul_u64(
                &[
                    18446744056529680064,
                    18446744056529682109,
                    18446744056529675497,
                    18446744056529676819,
                    18446744056529674746,
                    18446744056529678190,
                    18446744056529681095,
                    18446744056529675307,
                    18446744056529676147,
                    18446744056529674660,
                    18446744056529679306,
                    18446744056529679462,
                    18446744056529674505,
                    18446744056529675507,
                    18446744056529679413,
                    18446744056529680059,
                    18446744056529678448,
                    18446744056529678060,
                    18446744056529678936,
                    18446744056529681571,
                    18446744056529673130
                ],
                &[
                    18446744056529675340,
                    18446744056529672993,
                    18446744056529681814,
                    18446744056529675528,
                    18446744056529674758,
                    18446744056529680166,
                    18446744056529678611,
                    18446744056529681310,
                    18446744056529681285,
                    18446744056529674966,
                    18446744056529678618,
                    18446744056529673034,
                    18446744056529678813,
                    18446744056529678141,
                    18446744056529675270,
                    18446744056529673128,
                    18446744056529679304,
                    18446744056529679319,
                    18446744056529679285,
                    18446744056529679939,
                    18446744056529677212
                ],
                18446744056529682433
            )
        )
    }
    #[test]
    fn check_polydiv_polymod_u64() {
        assert_eq!(
            Some(vec![0u64.wrapping_sub(7), 0u64.wrapping_sub(1), 4]),
            polydiv_u64(&[1, 2, 0, 3, 4], &[2, 1, 1], 0)
        );
        assert_eq!(
            Some(vec![15, 11]),
            polymod_u64(&[1, 2, 0, 3, 4], &[2, 1, 1], 0)
        );
    }
}
